---
import { getEntry } from "astro:content";
import { render } from "astro:content";
import { getCollection } from "astro:content";

import WritingsPage from "$common/WritingsPage.astro";
import EmojiWrapper from "$components/EmojiWrapper.astro";
import Article from "$layouts/Article.astro";
import Section from "$layouts/Section.astro";

import { defaultDescription } from "../index.astro";

export async function getStaticPaths() {
    return (await getCollection("stories")).map((v) => {
        return { params: { id: v.id } };
    });
}

const { id } = Astro.params;
const entry = await getEntry("stories", id);
if (entry === undefined) {
    return Astro.redirect("/404");
}

const { Content, headings } = await render(entry);
---

<WritingsPage pageName={`'${entry.data.title}'`} desc={entry.data.description || defaultDescription}>
    <Fragment slot="nav:page-links">
        {headings.map((v) => <a href={`#${v.slug}`}>{v.text}</a>)}
    </Fragment>

    <Article>
        <Fragment slot="heading">
            {entry.data.title}
        </Fragment>

        <div id="content">
            <EmojiWrapper>
                <Content
                    components={{
                        section: Section,
                    }}
                />
            </EmojiWrapper>

            <style is:global>
                #content ::before,
                #content ::after {
                    all: unset;
                }

                #content p {
                    margin-block: 1.5rem;
                    line-height: 1.5em;
                    text-wrap: wrap stable;
                    white-space: pre-line;
                }

                #content h1,
                #content h2,
                #content h3,
                #content h4,
                #content h5,
                #content h6 {
                    text-align: center;
                    font-weight: 500;
                }

                #content section > p:has(code) {
                    text-align: center;
                }

                #content blockquote > * {
                    margin: 0;
                }
            </style>
        </div>
    </Article>
</WritingsPage>
