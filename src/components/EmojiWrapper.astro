---
import { experimental_AstroContainer } from "astro/container";
import emojiRegex from "emoji-regex";

import Emoji from "./Emoji.astro";

let content = await Astro.slots.render("default");

const container = await experimental_AstroContainer.create();

let html = "";
const regex = emojiRegex();
for (const match of content.matchAll(regex)) {
    const emoji = match[0];

    const index = content.indexOf(emoji);
    html += content.substring(0, index);
    const emojiHtml = (await container.renderToString(Emoji, { props: { e: emoji } })).trim();
    html += emojiHtml;
    content = content.substring(index + emoji.length);
}
html += content;
---

<Fragment set:html={html} />
