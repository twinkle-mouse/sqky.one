---
import type { HTMLAttributes } from "astro/types";

export type Props = HTMLAttributes<"img"> & {
    e: string;
};

const { e, ...props } = Astro.props;

// this is the most evil code i could've ever done
export function getEmojiUrl(e: string) {
    let codes: string[] = [];
    const codesList = [codes];

    for (let i = 0; ; i++) {
        const code = e.codePointAt(i);
        if (!code) break;

        const encoded = code.toString(16);
        if (encoded == "200d") {
            codes = [];
            codesList.push(codes);
            continue;
        }
        if (encoded.startsWith("fe0")) {
            continue;
        }

        codes.push(encoded);
    }

    const path = codesList.map((codes) => codes.filter((_, index) => index % 2 == 0).join("_")).join("_200d_");
    return `/noto-emoji/emoji_u${path}.svg`;
}

const url = getEmojiUrl(e);
---

<img {...props} src={url} alt={e} loading="eager" />

<style>
    img {
        display: inline-block;
        width: 1.25em;
        height: 1.25em;
        vertical-align: text-bottom;
    }
</style>
